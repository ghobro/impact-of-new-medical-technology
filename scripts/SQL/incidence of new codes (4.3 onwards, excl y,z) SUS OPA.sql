/*
This script extracts all outpatient attendances where the primary procedure code did not exist in OPCS-4.2.

That is, the code was added the classification from April 2006.

It uses SUS data. 
*/

select 
	year([Appointment_Date]) as [year], 
	substring([Der_Procedure_All],1,4) as [primary_procedure], 
	COUNT(*) as [n] 
from [SUS_OPA].[OPA_Core] 
where 
	substring([Der_Procedure_All],1,4) in ('A707', 'A847', 'C647', 'C658', 'C659', 'C871', 'C873', 'C874', 'C875', 'C878', 'C879', 'C911', 'C918', 'C919', 'E851', 'E852', 'E853', 'E854', 'E855', 'E856', 'E858', 'E859', 'E871', 'E872', 'E873', 'E874', 'E878', 'E879', 'E891', 'E892', 'E893', 'E894', 'E895', 'E898', 'E899', 'E911', 'E912', 'E913', 'E918', 'E919', 'E921', 'E922', 'E923', 'E924', 'E925', 'E926', 'E927', 'E928', 'E929', 'E931', 'E932', 'E933', 'E934', 'E935', 'E936', 'E937', 'E938', 'E939', 'E941', 'E942', 'E943', 'E944', 'E948', 'E949', 'E951', 'E952', 'E953', 'E954', 'E958', 'E959', 'E971', 'E972', 'E973', 'E978', 'E979', 'E981', 'E982', 'E983', 'E984', 'E988', 'E989', 'F096', 'F631', 'F632', 'F633', 'F634', 'F638', 'F639', 'G483', 'G484', 'H627', 'J681', 'J688', 'J689', 'K586', 'K648', 'K649', 'M171', 'M172', 'M173', 'M174', 'M175', 'M178', 'M179', 'M712', 'N351', 'N352', 'N353', 'N358', 'N359', 'Q198', 'Q199', 'Q556', 'Q581', 'Q582', 'Q588', 'Q589', 'R062', 'R068', 'R069', 'R078', 'R079', 'R088', 'R089', 'R091', 'R098', 'R099', 'R361', 'R362', 'R363', 'R368', 'R369', 'R371', 'R372', 'R373', 'R374', 'R375', 'R376', 'R378', 'R379', 'R381', 'R382', 'R383', 'R388', 'R389', 'R401', 'R402', 'R408', 'R409', 'R421', 'R422', 'R423', 'R424', 'R428', 'R429', 'R431', 'R432', 'R438', 'R439', 'S121', 'S122', 'S123', 'S124', 'S128', 'S129', 'S291', 'S292', 'S293', 'S294', 'S295', 'S298', 'S299', 'S321', 'S322', 'S323', 'S324', 'S325', 'S328', 'S329', 'S401', 'S402', 'S403', 'S404', 'S408', 'S409', 'S581', 'S582', 'S588', 'S589', 'S591', 'S592', 'S598', 'S599', 'T912', 'U011', 'U012', 'U013', 'U018', 'U019', 'U041', 'U042', 'U043', 'U044', 'U048', 'U049', 'U051', 'U052', 'U053', 'U054', 'U055', 'U058', 'U059', 'U061', 'U063', 'U064', 'U065', 'U068', 'U069', 'U071', 'U072', 'U073', 'U078', 'U079', 'U081', 'U082', 'U083', 'U084', 'U085', 'U088', 'U089', 'U091', 'U092', 'U093', 'U098', 'U099', 'U101', 'U102', 'U103', 'U104', 'U105', 'U106', 'U107', 'U108', 'U109', 'U111', 'U112', 'U113', 'U114', 'U115', 'U116', 'U117', 'U118', 'U119', 'U121', 'U122', 'U123', 'U124', 'U125', 'U126', 'U128', 'U129', 'U131', 'U132', 'U133', 'U134', 'U135', 'U136', 'U138', 'U139', 'U141', 'U142', 'U143', 'U144', 'U148', 'U149', 'U151', 'U152', 'U153', 'U158', 'U159', 'U161', 'U162', 'U168', 'U169', 'U171', 'U172', 'U173', 'U174', 'U175', 'U176', 'U177', 'U178', 'U179', 'U181', 'U182', 'U183', 'U188', 'U189', 'U192', 'U193', 'U194', 'U195', 'U196', 'U198', 'U199', 'U201', 'U203', 'U204', 'U205', 'U206', 'U208', 'U209', 'U211', 'U212', 'U213', 'U214', 'U215', 'U216', 'U217', 'U218', 'U219', 'U221', 'U222', 'U223', 'U224', 'U225', 'U226', 'U227', 'U228', 'U229', 'U231', 'U232', 'U233', 'U234', 'U238', 'U239', 'U241', 'U242', 'U243', 'U248', 'U249', 'U251', 'U252', 'U253', 'U254', 'U255', 'U258', 'U259', 'U261', 'U262', 'U263', 'U264', 'U265', 'U268', 'U269', 'U271', 'U272', 'U273', 'U274', 'U275', 'U276', 'U277', 'U278', 'U279', 'U281', 'U282', 'U283', 'U284', 'U285', 'U286', 'U287', 'U288', 'U289', 'U291', 'U292', 'U293', 'U294', 'U295', 'U296', 'U297', 'U298', 'U299', 'U301', 'U308', 'U309', 'U311', 'U318', 'U319', 'U321', 'U328', 'U329', 'U331', 'U332', 'U333', 'U338', 'U339', 'U341', 'U348', 'U349', 'U351', 'U352', 'U353', 'U354', 'U355', 'U358', 'U359', 'U361', 'U362', 'U363', 'U364', 'U365', 'U368', 'U369', 'U371', 'U372', 'U378', 'U379', 'U381', 'U388', 'U389', 'U401', 'U402', 'U403', 'U408', 'U409', 'U411', 'U412', 'U418', 'U419', 'U501', 'U502', 'U503', 'U504', 'U505', 'U506', 'U508', 'U509', 'U511', 'U512', 'U513', 'U518', 'U519', 'U521', 'U522', 'U528', 'U529', 'U531', 'U532', 'U533', 'U534', 'U538', 'U539', 'U541', 'U542', 'U543', 'U548', 'U549', 'V125', 'V551', 'V552', 'V553', 'V558', 'V559', 'X161', 'X162', 'X168', 'X169', 'X364', 'X391', 'X392', 'X393', 'X394', 'X395', 'X396', 'X398', 'X399', 'X431', 'X438', 'X439', 'X444', 'X448', 'X449', 'X495', 'X496', 'X497', 'X505', 'X512', 'X521', 'X522', 'X528', 'X529', 'X561', 'X562', 'X563', 'X568', 'X569', 'X588', 'X589', 'X601', 'X602', 'X603', 'X604', 'X608', 'X609', 'X611', 'X612', 'X613', 'X614', 'X618', 'X619', 'X621', 'X622', 'X623', 'X628', 'X629', 'X651', 'X652', 'X653', 'X654', 'X655', 'X656', 'X657', 'X658', 'X659', 'X661', 'X662', 'X668', 'X669', 'X671', 'X672', 'X673', 'X674', 'X675', 'X676', 'X677', 'X678', 'X679', 'X681', 'X682', 'X683', 'X688', 'X689', 'X691', 'X692', 'X698', 'X699', 'X701', 'X702', 'X703', 'X704', 'X705', 'X708', 'X709', 'X711', 'X712', 'X713', 'X714', 'X715', 'X718', 'X719', 'X721', 'X722', 'X723', 'X724', 'X728', 'X729', 'X731', 'X738', 'X739', 'X741', 'X742', 'X748', 'X749', 'X818', 'X819', 'X821', 'X822', 'X823', 'X824', 'X828', 'X829', 'X831', 'X832', 'X833', 'X838', 'X839', 'X841', 'X842', 'X843', 'X848', 'X849', 'X851', 'X852', 'X853', 'X854', 'X855', 'X856', 'X858', 'X859', 'X861', 'X862', 'X863', 'X864', 'X865', 'X866', 'X867', 'X868', 'X869', 'X871', 'X872', 'X873', 'X874', 'X878', 'X879', 'X888', 'X889', 'X891', 'X892', 'X893', 'X894', 'X895', 'X898', 'X899', 'X901', 'X902', 'X903', 'X904', 'X905', 'X906', 'X907', 'X908', 'X909', 'X911', 'X912', 'X913', 'X914', 'X918', 'X919', 'X921', 'X922', 'X923', 'X924', 'X928', 'X929', 'X931', 'X932', 'X933', 'X938', 'X939', 'X948', 'X949', 'X951', 'X952', 'X958', 'X959', 'X961', 'X962', 'X963', 'X968', 'X969', 'X978', 'X979', 'X981', 'X988', 'X989', 'O481') 
	and year([Appointment_Date]) between 2000 and 2022
group by 
	year([Appointment_Date]), 
	substring(Der_Procedure_All,1,4);
